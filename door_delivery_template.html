<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Door Delivery Labels</title>
  <style>
    :root{
      --pad: 12px;
      --gap: 10px;
      --rule: 1px solid #666;
      --font: "Times New Roman", Times, serif;
    }
    * { box-sizing: border-box; }

    /* Keep printer margins tiny; change if your printer needs more. */
    @page { size: A4; margin: 8mm; }
    @media print {
      body { margin: 0; }
      .page-break { page-break-after: always; }
    }

    body {
      font-family: var(--font);
      color:#000;
      margin: 0;
      padding: 8mm;
    }

    .label {
      padding: var(--pad);
    }

    .hdr-line-1 { text-align:center; font-weight:700; font-size: 18px; letter-spacing: .3px; }
    .hdr-line-2 { text-align:center; font-weight:700; font-size: 14px; margin-top: 2px; }
    .hdr-line-3 { text-align:center; font-weight:700; font-size: 13px; margin-top: 2px; }

    .meta-row {
      display:flex; justify-content:space-between; align-items:center;
      margin-top: 10px; font-size: 14px;
      font-weight:600;
    }
    .meta-left  span.label { font-weight:700; }
    .meta-center { text-decoration: underline; font-weight:700; }
    .meta-right { text-align:right; }

    .addr-block { margin-top: 14px; line-height:1.3; font-size: 15px; }

    .mag-line {
      text-align:center; margin: 16px 0 8px; font-weight:700; font-size: 15px;
    }

    .counts {
      display:flex; flex-wrap:wrap;
      justify-content: space-between;
      margin-top: 8px; font-size: 14px; 
    }

    .bold700{
      font-weight:700;
    }

    .bundles {
      margin-top: 8px; font-size: 14px; 
    }

    .sign-row {
      display:flex; flex-wrap:wrap;
      justify-content: space-between;
      margin-top: 8px; font-size: 14px; font-weight:700;
    }
    .sign-cell { min-height: 34px; display:flex; align-items:flex-end; }
    .sign-label { font-weight:700; }

    hr.sep {
      border:none; border-top: var(--rule);
      margin: 12px 0;
    }
  </style>
</head>
<body>
<? var dc_no = 0; ?>
<? for (var i = 0; i < labels_data.length; i++) {
     var L = labels_data[i] || {};
     dc_no = i + 1;

     // phone/mobile join logic
     var phoneBits = [];
     if (L.phone)  phoneBits.push(String(L.phone).trim());
     if (L.mobile) phoneBits.push(String(L.mobile).trim());
     var phoneJoin = phoneBits.join(" | ");

     // totals
     var nb1 = Number(L.nbox1 || 0);
     var cb1 = Number(L.ncopies_box1 || 0);
     var nb2 = Number(L.nbox2 || 0);
     var cb2 = Number(L.ncopies_box2 || 0);
     var free = Number(L.free_copies || 0);
     var invoiced = (nb1 * cb1 || 0) + (nb2 * cb2 || 0);
     var total = invoiced + free;
    // bundles line (conditionally add the 2nd set)
     var bundlesLine = nb1 + "  BUNDLE(S)  @  " + cb1 + "  COPIES";
     if (nb2 && cb2) {
       bundlesLine += "   &   " + nb2 + "  BUNDLE(S)  @  " + cb2 + "  COPIES";
     }
?>

  <div class="label">
    <!-- HEADER -->
    <div class="hdr-line-1">SRI RAMAKRISHNA MATH</div>
    <div class="hdr-line-2">MYLAPORE, CHENNAI 600 004</div>
    <div class="hdr-line-3">PH: 044-24621110, EXTN: 215</div>

    <!-- TOP META -->
    <div class="meta-row">
      <div class="meta-left">DC NO. <?= dc_no ?> / <?= date ?></div>
      <div class="meta-center">DELIVERY NOTE</div>
      <div class="meta-right">AGENCY NO. <?= L.ss_no || "" ?></div>
    </div>

    <!-- ADDRESS -->
    <div class="addr-block">
      <div><?= L.customer_name || "" ?></div>
      <div><?= L.shipping_address || "" ?></div>
      <div><?= L.shipping_address2 || "" ?></div>
      <div>
        <?= (L.shipping_city || "") ?> <?= (L.shipping_zip || "") ?>
        <? if (phoneJoin) { ?> / MOBILE: <?= phoneJoin ?> <? } ?>
      </div>
    </div>

    <!-- MAGAZINE + DATE -->
    <div class="mag-line"><?= magazine_name.toUpperCase() ?></div>

    <!-- COUNTS -->
    <div class="counts">
      <div>INVOICED COPIES: <span class="bold700"><?= invoiced ?></span></div>
      <div>FREE COPIES: <span class="bold700"><?= free ?></span></div>
      <div>TOTAL: <span class="bold700"><?= total ?></span> COPIES</div>
    </div>

    <!-- BUNDLES -->
    <div class="bundles"><?=  bundlesLine ?></div>

    <!-- SIGNATURE ROW -->
    <div class="sign-row">
      <div class="sign-cell"><span class="sign-label">PREPARED BY:&nbsp;<?= prepared_by_name ?></span></div>
      <div class="sign-cell"><span class="sign-label">RECEIVER NAME</span></div>
      <div class="sign-cell"><span class="sign-label">RECEIVER SIGNATURE</span></div>
    </div>

    <hr class="sep" />
  </div>

  <!-- Break page after every 3 labels -->
  <? if ((i + 1) % 3 === 0 && (i + 1) !== labels_data.length) { ?>
    <div class="page-break"></div>
  <? } ?>

<? } /* end for */ ?>

<script>
  // Optional: auto-open print dialog if you open this file directly
  // window.onload = () => window.print();
</script>
</body>
</html>
